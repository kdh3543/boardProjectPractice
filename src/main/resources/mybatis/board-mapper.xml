<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="board">
  	<insert id="insert">
  		insert into board values(board_seq.nextval,#{writer},#{title},#{contents},default,default)
  	</insert>
  	<select id="selectAll" resultType="kdh.personal.dto.BoardDTO">
  		select * from board order by seq
  	</select>
  	<select id="selectContents" resultType="kdh.personal.dto.BoardDTO">
  		select * from board where seq = #{value}
  	</select>
  	<delete id="deleteBySeq">
  		delete board where seq = #{value}
  	</delete>
  	<update id="modifyBoard">
  		update board set title = #{title}, contents = #{contents} where seq = #{seq} 
  	</update>
  	<select id="searchAll" resultType="kdh.personal.dto.BoardDTO">
  		select * from (select board.*, row_number() over(order by seq desc) rn 
		from board where title like '%'||#{result}||'%' or writer like '%'||#{result}||'%')
		where rn between #{start} and #{end} 
  	</select>
  	<select id="searchByTitle" resultType="kdh.personal.dto.BoardDTO">
  		select * from (select board.*, row_number() over(order by seq desc) rn 
		from board where title like '%'||#{result}||'%')
		where rn between #{start} and #{end} 
  	</select>
  	<select id="searchByWriter" resultType="kdh.personal.dto.BoardDTO">
  		select * from (select board.*, row_number() over(order by seq desc) rn 
		from board where writer like '%'||#{result}||'%')
		where rn between #{start} and #{end} 
  	</select>
  	<select id="getRecordCount" resultType="int">
  		select count(*) from board
  	</select>
  	<select id="getRecordCountByAll" resultType="int">
  		select count(*) from board where writer like '%'||#{value}||'%' or title like '%'||#{value}||'%'
  	</select>
  	<select id="getRecordCountByWriter" resultType="int">
  		select count(*) from board where writer like '%'||#{value}||'%'
  	</select>
  	<select id="getRecordCountByTitle" resultType="int">
  		select count(*) from board where title like '%'||#{value}||'%'
  	</select>
  	<!-- 페이징에 따른 쿼리문 -->
  	<select id="selectByBound" resultType="kdh.personal.dto.BoardDTO">
  		select * from (select board.*, row_number() over(order by seq desc) rn 
		from board)where rn between #{start} and #{end}
  	</select>
  	<update id="addViewCount">
  		update board set view_count = view_count + 1 where seq = #{value}
  	</update>
  </mapper>